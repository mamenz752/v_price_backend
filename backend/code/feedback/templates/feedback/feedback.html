{% extends 'config/base_feedback.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h2>キャベツ</h2>

    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="{% url 'feedback:chinese_cabbage' %}">はくさい</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'feedback:cabbage' %}">キャベツ</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'feedback:cucumber' %}">きゅうり</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'feedback:tomato' %}">トマト</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'feedback:eggplant' %}">なす</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'feedback:radish' %}">だいこん</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'feedback:potato' %}">ばれいしょ</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'feedback:onion' %}">たまねぎ</a>
        </li>
    </ul>

     <div>
    <h1>
    {% block v_name %}
        
    {% endblock v_name %}</h1>
            <h2>代表値</h2>
            <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    補正R2
                    <span class="badge bg-primary rounded-pill">14</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    標準誤差
                    <span class="badge bg-primary rounded-pill">2</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    MAE
                    <span class="badge bg-primary rounded-pill">1</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    RMSE
                    <span class="badge bg-primary rounded-pill">1</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    有意F
                    <span class="badge bg-primary rounded-pill">1</span>
                </li>
            </ul>
            <div>
                <h1>全体評価</h1>
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">優良</h5>
                        <p class="card-text">過去12カ月の予測値の正解率は80%です．しばらくはモデルが使えます．</p>
                    </div>
                    </div>
            </div>
        </div>
        <div>
            <h2>各野菜ごとのロジック</h2>
            <p>各タブに野菜</p>
            <p>説明変数テーブル</p>
            <table>
                <tr>
                    <th>説明変数</th>
                    <th>係数</th>
                    <th>t値</th>
                    <th>p値</th>
                </tr>
                <tr>
                    <td>切片</td>
                    <td>-1.2</td>
                    <td>-3.5</td>
                    <td>0.001</td>
                </tr>
                <tr>
                    <td>平均気温</td>
                    <td>0.5</td>
                    <td>2.3</td>
                    <td>0.02</td>
                </tr>
                <tr>
                    <td>降水量</td>
                    <td>-0.3</td>
                    <td>-1.8</td>
                    <td>0.07</td>
                </tr>
            </table>
        </div>

        <section class="event-calendar">
            <h4 class="contents-header">{% block calendar_title %}{% endblock %}</h4>
            <div class="calendar_plot">
                <div id="calendar"></div>
            </div>
        </section>
        
        <!-- モデル実行ボタン -->
        <div class="mt-4 p-3 bg-light rounded">
            <h5>モデル実行テスト</h5>
            <p class="small text-muted">指定された年月・日付に基づいてComputeMarket/ComputeWeatherを生成し、予測モデルを実行します</p>
            
            <!-- 現在日時での実行 -->
            <div class="mb-3">
                <form method="post" action="{% url 'observe:run_model_by_webhook' %}" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="year" id="current_year" value="">
                    <input type="hidden" name="month" id="current_month" value="">
                    <input type="hidden" name="day" id="current_day" value="">
                    <button type="submit" class="btn btn-outline-primary">
                        現在日時でモデル実行
                    </button>
                </form>
            </div>
            
            <!-- 手動設定での実行 -->
            <div>
                <form method="post" action="{% url 'observe:run_model_by_webhook' %}" class="row g-2">
                    {% csrf_token %}
                    <div class="col-auto">
                        <input type="number" name="year" min="2000" max="2100" placeholder="年" class="form-control" required>
                    </div>
                    <div class="col-auto">
                        <input type="number" name="month" min="1" max="12" placeholder="月" class="form-control" required>
                    </div>
                    <div class="col-auto">
                        <select name="day" class="form-select" required>
                            <option value="">日付を選択</option>
                            <option value="1">1日（前半）</option>
                            <option value="16">16日（後半）</option>
                        </select>
                    </div>
                    <div class="col-auto">
                        <button type="submit" class="btn btn-primary">実行</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // 自動で現在の年/月/日 を hidden フィールドに設定
        (function(){
            try {
                const d = new Date();
                document.getElementById('current_year').value = d.getFullYear();
                document.getElementById('current_month').value = d.getMonth() + 1;
                document.getElementById('current_day').value = d.getDate();
            } catch (e) { 
                console.error('日付設定エラー:', e);
            }
        })();
    </script>
{% endblock content %}